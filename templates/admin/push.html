{% extends "admin/layout.html" %} {% block title %}ORBIS Admin - Push
Bildirimleri{% endblock %} {% block page_title %}Push Bildirimleri{% endblock %}
{% block page_subtitle %}KullanÄ±cÄ±lara bildirim gÃ¶nder{% endblock %} {% block
content %}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <!-- Send Notification Form -->
  <div class="glass-card rounded-2xl p-6">
    <h3 class="font-display font-bold text-lg mb-6 flex items-center gap-2">
      <span class="material-icons-round text-primary">send</span>
      Bildirim GÃ¶nder
    </h3>

    <form id="push-form" class="space-y-5">
      <!-- Target Type -->
      <div>
        <label
          class="block text-xs text-slate-500 uppercase tracking-wider mb-2"
          >Hedef</label
        >
        <div class="grid grid-cols-3 gap-2">
          <label
            class="target-option flex items-center justify-center gap-2 p-3 bg-white/5 rounded-xl cursor-pointer border-2 border-transparent hover:border-primary/30 transition-all"
          >
            <input
              type="radio"
              name="targetType"
              value="all"
              class="hidden"
              checked
            />
            <span class="material-icons-round text-lg">groups</span>
            <span class="text-sm">Herkese</span>
          </label>
          <label
            class="target-option flex items-center justify-center gap-2 p-3 bg-white/5 rounded-xl cursor-pointer border-2 border-transparent hover:border-primary/30 transition-all"
          >
            <input
              type="radio"
              name="targetType"
              value="topic"
              class="hidden"
            />
            <span class="material-icons-round text-lg">label</span>
            <span class="text-sm">Topic</span>
          </label>
          <label
            class="target-option flex items-center justify-center gap-2 p-3 bg-white/5 rounded-xl cursor-pointer border-2 border-transparent hover:border-primary/30 transition-all"
          >
            <input type="radio" name="targetType" value="user" class="hidden" />
            <span class="material-icons-round text-lg">person</span>
            <span class="text-sm">KullanÄ±cÄ±</span>
          </label>
        </div>
      </div>

      <!-- Topic Select (hidden by default) -->
      <div id="topic-select" class="hidden">
        <label
          class="block text-xs text-slate-500 uppercase tracking-wider mb-2"
          >Topic SeÃ§</label
        >
        <select
          id="topic"
          class="w-full px-4 py-3 bg-white/5 border border-border-dark rounded-xl text-sm focus:outline-none focus:border-primary/50"
        >
          <option value="all_users">TÃ¼m KullanÄ±cÄ±lar</option>
          <option value="premium_users">Premium KullanÄ±cÄ±lar</option>
          <option value="daily_horoscope">GÃ¼nlÃ¼k BurÃ§ Aboneleri</option>
          <option value="weekly_horoscope">HaftalÄ±k BurÃ§ Aboneleri</option>
        </select>
      </div>

      <!-- User ID Input (hidden by default) -->
      <div id="user-select" class="hidden">
        <label
          class="block text-xs text-slate-500 uppercase tracking-wider mb-2"
          >KullanÄ±cÄ± ID</label
        >
        <input
          type="text"
          id="userId"
          placeholder="Firebase User ID"
          class="w-full px-4 py-3 bg-white/5 border border-border-dark rounded-xl text-sm focus:outline-none focus:border-primary/50"
        />
      </div>

      <!-- Title -->
      <div>
        <label
          class="block text-xs text-slate-500 uppercase tracking-wider mb-2"
          >BaÅŸlÄ±k</label
        >
        <input
          type="text"
          id="title"
          placeholder="Bildirim baÅŸlÄ±ÄŸÄ±"
          required
          class="w-full px-4 py-3 bg-white/5 border border-border-dark rounded-xl text-sm focus:outline-none focus:border-primary/50"
        />
      </div>

      <!-- Body -->
      <div>
        <label
          class="block text-xs text-slate-500 uppercase tracking-wider mb-2"
          >Mesaj</label
        >
        <textarea
          id="body"
          rows="4"
          placeholder="Bildirim iÃ§eriÄŸi"
          required
          class="w-full px-4 py-3 bg-white/5 border border-border-dark rounded-xl text-sm focus:outline-none focus:border-primary/50 resize-none"
        ></textarea>
      </div>

      <!-- Submit -->
      <button
        type="submit"
        class="w-full flex items-center justify-center gap-2 px-6 py-4 bg-primary hover:bg-primary/80 rounded-xl text-sm font-bold uppercase tracking-wider transition-colors"
      >
        <span class="material-icons-round">send</span>
        Bildirimi GÃ¶nder
      </button>
    </form>
  </div>

  <!-- Quick Templates -->
  <div class="space-y-6">
    <!-- Templates -->
    <div class="glass-card rounded-2xl p-6">
      <h3 class="font-display font-bold text-lg mb-4 flex items-center gap-2">
        <span class="material-icons-round text-primary">description</span>
        HazÄ±r Åablonlar
      </h3>

      <div class="space-y-3">
        <button
          onclick="useTemplate('daily')"
          class="w-full flex items-center gap-3 p-4 bg-white/5 hover:bg-white/10 rounded-xl transition-colors text-left"
        >
          <span class="material-icons-round text-yellow-400">wb_sunny</span>
          <div>
            <div class="font-medium text-sm">GÃ¼nlÃ¼k BurÃ§ Yorumu</div>
            <div class="text-xs text-slate-500">
              GÃ¼nlÃ¼k burÃ§ yorumunuz hazÄ±r!
            </div>
          </div>
        </button>

        <button
          onclick="useTemplate('weekly')"
          class="w-full flex items-center gap-3 p-4 bg-white/5 hover:bg-white/10 rounded-xl transition-colors text-left"
        >
          <span class="material-icons-round text-accent">date_range</span>
          <div>
            <div class="font-medium text-sm">HaftalÄ±k Analiz</div>
            <div class="text-xs text-slate-500">
              Bu haftanÄ±n kozmik enerjileri...
            </div>
          </div>
        </button>

        <button
          onclick="useTemplate('promo')"
          class="w-full flex items-center gap-3 p-4 bg-white/5 hover:bg-white/10 rounded-xl transition-colors text-left"
        >
          <span class="material-icons-round text-green-400">local_offer</span>
          <div>
            <div class="font-medium text-sm">Premium Kampanya</div>
            <div class="text-xs text-slate-500">Ã–zel indirim fÄ±rsatÄ±!</div>
          </div>
        </button>

        <button
          onclick="useTemplate('update')"
          class="w-full flex items-center gap-3 p-4 bg-white/5 hover:bg-white/10 rounded-xl transition-colors text-left"
        >
          <span class="material-icons-round text-purple-400"
            >system_update</span
          >
          <div>
            <div class="font-medium text-sm">GÃ¼ncelleme Duyurusu</div>
            <div class="text-xs text-slate-500">Yeni Ã¶zellikler eklendi!</div>
          </div>
        </button>
      </div>
    </div>

    <!-- Preview -->
    <div class="glass-card rounded-2xl p-6">
      <h3 class="font-display font-bold text-lg mb-4 flex items-center gap-2">
        <span class="material-icons-round text-primary">preview</span>
        Ã–nizleme
      </h3>

      <div class="bg-slate-800 rounded-2xl p-4 border border-slate-700">
        <!-- Mock notification -->
        <div class="flex items-start gap-3">
          <div
            class="w-10 h-10 rounded-xl bg-primary/20 flex items-center justify-center flex-shrink-0"
          >
            <span class="material-icons-round text-primary">all_inclusive</span>
          </div>
          <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between">
              <span class="font-medium text-sm" id="preview-title">ORBIS</span>
              <span class="text-[10px] text-slate-500">ÅŸimdi</span>
            </div>
            <p
              id="preview-body"
              class="text-xs text-slate-400 mt-1 line-clamp-2"
            >
              Bildirim Ã¶nizlemesi burada gÃ¶rÃ¼necek...
            </p>
          </div>
        </div>
      </div>

      <p class="text-[10px] text-slate-600 mt-3 text-center">
        GerÃ§ek bildirim gÃ¶rÃ¼nÃ¼mÃ¼ cihaza gÃ¶re deÄŸiÅŸebilir
      </p>
    </div>

    <!-- Stats -->
    <div class="glass-card rounded-2xl p-6">
      <h3 class="font-display font-bold text-lg mb-4 flex items-center gap-2">
        <span class="material-icons-round text-primary">analytics</span>
        Topic Ä°statistikleri
      </h3>

      <div class="space-y-3">
        <div
          class="flex items-center justify-between p-3 bg-white/5 rounded-xl"
        >
          <span class="text-sm">all_users</span>
          <span class="text-xs text-slate-500">TÃ¼m kayÄ±tlÄ± cihazlar</span>
        </div>
        <div
          class="flex items-center justify-between p-3 bg-white/5 rounded-xl"
        >
          <span class="text-sm">premium_users</span>
          <span class="text-xs text-slate-500">Premium Ã¼yeler</span>
        </div>
        <div
          class="flex items-center justify-between p-3 bg-white/5 rounded-xl"
        >
          <span class="text-sm">daily_horoscope</span>
          <span class="text-xs text-slate-500">GÃ¼nlÃ¼k aboneler</span>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  // Target type selection
  document.querySelectorAll('input[name="targetType"]').forEach((radio) => {
    radio.addEventListener("change", (e) => {
      // Update styles
      document.querySelectorAll(".target-option").forEach((opt) => {
        opt.classList.remove("border-primary", "bg-primary/10");
        opt.classList.add("border-transparent");
      });
      e.target
        .closest(".target-option")
        .classList.add("border-primary", "bg-primary/10");
      e.target.closest(".target-option").classList.remove("border-transparent");

      // Show/hide fields
      const value = e.target.value;
      document
        .getElementById("topic-select")
        .classList.toggle("hidden", value !== "topic");
      document
        .getElementById("user-select")
        .classList.toggle("hidden", value !== "user");
    });
  });

  // Initialize first option as selected
  document
    .querySelector(".target-option")
    .classList.add("border-primary", "bg-primary/10");

  // Live preview
  document.getElementById("title").addEventListener("input", updatePreview);
  document.getElementById("body").addEventListener("input", updatePreview);

  function updatePreview() {
    const title = document.getElementById("title").value || "ORBIS";
    const body =
      document.getElementById("body").value ||
      "Bildirim Ã¶nizlemesi burada gÃ¶rÃ¼necek...";

    document.getElementById("preview-title").textContent = title;
    document.getElementById("preview-body").textContent = body;
  }

  // Templates
  const templates = {
    daily: {
      title: "ğŸŒŸ GÃ¼nlÃ¼k BurÃ§ Yorumunuz HazÄ±r!",
      body: "BugÃ¼n yÄ±ldÄ±zlar sizin iÃ§in ne sÃ¶ylÃ¼yor? GÃ¼nlÃ¼k kozmik rehberinizi keÅŸfedin.",
    },
    weekly: {
      title: "ğŸ“… HaftalÄ±k Kozmik Analiz",
      body: "Bu haftanÄ±n astrolojik enerjileri ve size Ã¶zel tavsiyeleri gÃ¶rÃ¼ntÃ¼leyin.",
    },
    promo: {
      title: "ğŸ’ Premium'da %50 Ä°ndirim!",
      body: "SÄ±nÄ±rlÄ± sÃ¼re! Premium Ã¼yelikte bÃ¼yÃ¼k fÄ±rsat. Hemen keÅŸfedin.",
    },
    update: {
      title: "ğŸš€ ORBIS GÃ¼ncellendi!",
      body: "Yeni Ã¶zellikler ve iyileÅŸtirmeler sizi bekliyor. UygulamayÄ± aÃ§Ä±n ve keÅŸfedin.",
    },
  };

  function useTemplate(key) {
    const template = templates[key];
    document.getElementById("title").value = template.title;
    document.getElementById("body").value = template.body;
    updatePreview();
  }

  // Form submit
  document.getElementById("push-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const targetType = document.querySelector(
      'input[name="targetType"]:checked'
    ).value;
    const title = document.getElementById("title").value;
    const body = document.getElementById("body").value;

    let target = null;
    if (targetType === "topic") {
      target = document.getElementById("topic").value;
    } else if (targetType === "user") {
      target = document.getElementById("userId").value;
      if (!target) {
        showToast("KullanÄ±cÄ± ID gerekli", "error");
        return;
      }
    }

    try {
      const res = await fetch("/admin/api/push/send", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ targetType, target, title, body }),
      });

      const data = await res.json();

      if (data.success) {
        showToast("Bildirim baÅŸarÄ±yla gÃ¶nderildi!", "success");
        // Reset form
        document.getElementById("title").value = "";
        document.getElementById("body").value = "";
        updatePreview();
      } else {
        throw new Error(data.error || "GÃ¶nderim baÅŸarÄ±sÄ±z");
      }
    } catch (error) {
      console.error("Push error:", error);
      showToast(error.message, "error");
    }
  });
</script>
{% endblock %}
