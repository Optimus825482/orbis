{% extends "layout.html" %}

{% block title %}Hesaplamalarım - Astro AI{% endblock %}

{% block content %}
<div class="ui container">
    <h1 class="ui header">
        <i class="folder open outline icon"></i>
        <div class="content">
            Kayıtlı Hesaplamalarım
            <div class="sub header">Geçmiş astrolojik hesaplamalarınız ve yorumlarınız</div>
        </div>
    </h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="ui {{ 'negative' if category == 'error' else 'positive' }} message">
                    <i class="close icon"></i>
                    <div class="header">
                        {{ message }}
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="ui divider"></div>

    {% if calculations %}
        <div class="ui divided items">
            {% for calc in calculations %}
                <div class="item">
                    <div class="content">
                        <div class="header">
                            <a href="{{ url_for('main.display_results', calculation_id=calc.id) }}">
                                {{ calc.birth_data.name or 'İsimsiz Hesaplama' }}
                            </a>
                        </div>
                        <div class="meta">
                            <span class="date">Oluşturulma: {{ calc.created_at|date }}</span>
                        </div>
                        <div class="description">
                            <div class="ui list">
                                <div class="item">
                                    <i class="birthday cake icon"></i>
                                    <div class="content">
                                        <div class="header">Doğum Bilgileri</div>
                                        <div class="description">
                                            {{ calc.birth_data.birth_date|date }} - {{ calc.birth_data.birth_time|time }}
                                            <br>
                                            {{ calc.birth_data.birth_place or 'Yer bilgisi yok' }}
                                            ({{ calc.birth_data.latitude|safe_round(4) }}, {{ calc.birth_data.longitude|safe_round(4) }})
                                        </div>
                                    </div>
                                </div>
                                {% if calc.transit_data %}
                                <div class="item">
                                    <i class="calendar alternate outline icon"></i>
                                    <div class="content">
                                        <div class="header">Transit Bilgileri</div>
                                        <div class="description">
                                            {{ calc.transit_data.transit_date|date }} - {{ calc.transit_data.transit_time|time }}
                                            <br>
                                            {{ calc.transit_data.transit_place or 'Yer bilgisi yok' }}
                                            ({{ calc.transit_data.latitude|safe_round(4) }}, {{ calc.transit_data.longitude|safe_round(4) }})
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                                {% if calc.ai_interpretations and calc.ai_interpretations|length > 0 %}
                                <div class="item">
                                    <i class="comment alternate outline icon"></i>
                                    <div class="content">
                                        <div class="header">Yapay Zeka Yorumları</div>
                                        <div class="description">
                                            {% for interpretation in calc.ai_interpretations %}
                                                <div class="ui label">
                                                    {{ interpretation.type }}
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="extra">
                            <a class="ui right floated teal button" href="{{ url_for('main.display_results', calculation_id=calc.id) }}">
                                <i class="eye icon"></i>
                                Görüntüle
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="ui placeholder segment">
            <div class="ui icon header">
                <i class="folder open outline icon"></i>
                Henüz kaydedilmiş hesaplama bulunmuyor
            </div>
            <a class="ui teal button" href="{{ url_for('main.dashboard') }}">
                <i class="plus icon"></i>
                Yeni Hesaplama Yap
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    // Mesaj kapatma düğmelerini etkinleştir
    $('.message .close').on('click', function() {
        $(this).closest('.message').transition('fade');
    });
</script>
{% endblock %} 